<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salesforce Chat Embed - Test Page</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .hint { background:#f6f8fa; border-left:4px solid #2b7cff; padding:12px; margin-bottom:16px; }
  </style>
</head>
<body>
  <h1>Salesforce Embedded Chat - Test Page</h1>

  <div class="hint">
  </div>

  <p>Click the chat button that appears (usually a floating help/chat icon) to start the bot.</p>

  <!-- Load the Embedded Service core library -->
  <script src="https://service.force.com/embeddedservice/5.0/esw.min.js"></script>

  <script>
    // --- Values taken from the snippet you provided ---
    // Organization host (use your org's URL; do NOT use the -scrt URL here)
    var ORG_URL = 'https://trimbledx--dxced.sandbox.my.salesforce.com';

    // SCRT endpoint from your snippet (used internally by the widget)
    var SCRT_URL = 'https://trimbledx--dxced.sandbox.my.salesforce-scrt.com';

    // OrganizationId and DeveloperName from your JSON
    var ORG_ID = '00DO800000B0ay1';
    var DEPLOYMENT_NAME = 'Test_ChatBot';

    function initEmbeddedService(gslbBaseURL) {
      try {
        // Optional custom settings
        embedded_svc.settings.displayHelpButton = true;   // show the floating chat button
        embedded_svc.settings.language = 'en';

        // Initialize the Embedded Service widget
        embedded_svc.init(
          ORG_URL,         // Salesforce org url (NOT the scrt URL)
          SCRT_URL,        // SCRT endpoint (from your snippet)
          gslbBaseURL,     // usually null
          ORG_ID,          // OrganizationId
          DEPLOYMENT_NAME, // DeveloperName of the Embedded Service Deployment
          {
            // optional init configuration object
            // e.g. prepopulatedPrechatFields, entryFeature, storageDomain etc.
          }
        );

        console.log('Embedded Service initialized (init called).');
      } catch (err) {
        console.error('Error initializing Embedded Service:', err);
      }
    }

    // If the library is already available, init immediately. Otherwise wait for onload.
    if (window.embedded_svc) {
      initEmbeddedService(null);
    } else {
      // esw.min.js is already included above, but in case it's not loaded yet:
      window.addEventListener('load', function() {
        if (window.embedded_svc) {
          initEmbeddedService(null);
        } else {
          console.warn('embedded_svc lib not found after load.'); 
        }
      });
    }

    // Helpful debugging hooks
    window.addEventListener('error', function(e) {
      console.warn('Page error:', e.message || e);
    });
    window.addEventListener('unhandledrejection', function(e) {
      console.warn('Unhandled promise rejection:', e.reason || e);
    });
  </script>
</body>
</html>
